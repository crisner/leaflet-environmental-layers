{"version":3,"sources":["../src/fracTrackerMobileLayer.js"],"names":["L","GeoJSON","FracTrackerMobile","extend","options","initialize","Util","setOptions","_layers","onAdd","map","on","requestData","_map","onRemove","off","spin","clearLayers","self","bounds","getBounds","northEast","getNorthEast","southWest","getSouthWest","left","lng","right","top","lat","bottom","polygon","$","window","jQuery","fractrackerMobile_url","getJSON","done","data","parseData","i","features","length","addMarker","getMarker","coords","coordsToLatLng","geometry","coordinates","geometries","description","properties","date","Date","report_date","toUTCString","dateModified","modified_on","organizationName","created_by","organization_name","imageUrl","images","square","imageElement","marker","isNaN","circleMarker","radius","color","bindPopup","key","id","addLayer","LatLng","geoJSON","fracTrackerMobile"],"mappings":"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","sourcesContent":["L.GeoJSON.FracTrackerMobile = L.GeoJSON.extend(\r\n  {\r\n    options: { },\r\n\r\n    initialize: function(options) {\r\n      options = options || {};\r\n      L.Util.setOptions(this, options);\r\n      this._layers = {};\r\n    },\r\n\r\n    onAdd: function(map) {\r\n      map.on('moveend', this.requestData, this);\r\n      this._map = map;\r\n      this.requestData();\r\n    },\r\n\r\n    onRemove: function(map) {\r\n      map.off('moveend', this.requestData, this);\r\n      if (typeof map.spin === 'function') {\r\n        map.spin(false);\r\n      }\r\n      this.clearLayers();\r\n      this._layers = {};\r\n    },\r\n\r\n    requestData: function() {\r\n      var self = this;\r\n\r\n      (function() {\r\n        var bounds = self._map.getBounds();\r\n        var northEast = bounds.getNorthEast();\r\n        var southWest = bounds.getSouthWest();\r\n        var left = southWest.lng;\r\n        var right = northEast.lng;\r\n        var top = northEast.lat;\r\n        var bottom = southWest.lat;\r\n        var polygon = left + ' ' + top + ',' + right + ' ' + top + ',' + right + ' ' + bottom + ',' + left + ' ' + bottom + ',' + left + ' ' + top;\r\n        \r\n        var $ = window.jQuery;\r\n        var fractrackerMobile_url = 'https://cors-anywhere.herokuapp.com/https://api.fractracker.org/v1/data/report?page=1&results_per_page=250&q={\"filters\":[{\"name\":\"geometry\",\"op\":\"intersects\",\"val\":\"SRID=4326;POLYGON((' + polygon +'))\"}],\"order_by\":[{\"field\":\"report_date\",\"direction\":\"desc\"},{\"field\":\"id\",\"direction\":\"desc\"}]}';\r\n\r\n        if (typeof self._map.spin === 'function') {\r\n          self._map.spin(true);\r\n        }\r\n\r\n        return $.getJSON(fractrackerMobile_url);\r\n\r\n      })().done(function(data) {\r\n        self.parseData(data);\r\n        if (typeof self._map.spin === 'function') {\r\n          self._map.spin(false);\r\n        }\r\n      });\r\n    },\r\n\r\n    parseData: function(data) {\r\n      if (!!data) {\r\n        for ( var i = 0; i < data.features.length; i++) {\r\n          this.addMarker(data.features[i]);\r\n        }\r\n      }\r\n    },\r\n\r\n    getMarker: function(data) {\r\n      var coords = this.coordsToLatLng(data.geometry.coordinates || data.geometry.geometries[0].coordinates);\r\n      var lat = coords.lat;\r\n      var lng = coords.lng;\r\n      var description = data.properties.description ? data.properties.description : '';\r\n      var date = new Date(data.properties.report_date).toUTCString();\r\n      var dateModified = new Date(data.properties.modified_on).toUTCString();\r\n      var organizationName = data.properties.created_by.organization_name ? data.properties.created_by.organization_name : '';\r\n      var imageUrl = data.properties.images[0] && data.properties.images[0].properties.square;\r\n      var imageElement = imageUrl ? '<img src=\"'  + imageUrl + '\" alt=\"User image\" width=\"100%\" />' : '';\r\n      var marker;\r\n      if (!isNaN((lat)) && !isNaN((lng)) ) {\r\n        marker = new L.circleMarker([lat, lng], { radius: 5, color: '#e4458b'})\r\n        .bindPopup(imageElement + '<br><strong>'+ description + '</strong><br>Lat : ' + lat + '<br>Lon : '+ lng + '<br>Reported on : ' + date + '<br>Modified on : ' + dateModified + '<br>' + organizationName);\r\n      }\r\n      return marker;\r\n    },\r\n\r\n    addMarker: function(data) {\r\n      var marker;\r\n      var key = data.id;\r\n      if (!this._layers[key]) {\r\n        marker = this.getMarker(data);\r\n        this._layers[key] = marker;\r\n        this.addLayer(marker);\r\n      }\r\n    },\r\n\r\n    coordsToLatLng: function(coords) {\r\n      return new L.LatLng(coords[1], coords[0]);\r\n    },\r\n\r\n  },\r\n);\r\n\r\n\r\nL.geoJSON.fracTrackerMobile = function(options) {\r\n  return new L.GeoJSON.FracTrackerMobile(options);\r\n};\r\n"],"file":"fracTrackerMobileLayer.js"}